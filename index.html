
<!doctype html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Un premier jeu Phaser 3.0 </title>
    <script src="phaser.js"></script>
    <!-- MIDI - MIDI PARSER JS-->  
     <!-- <script src="https://colxi.info/midi-parser-js/src/main.js"></script> -->
    
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>

<body>

    <!-- AUDIO - HOWLER-->
    <button type="button" id="button" style="visibility: hidden; display: none;">play</button>
    <script src="node_modules/howler/dist/howler.js"></script>
    <script src="audio1.js"></script>

    <script src="https://unpkg.com/@tonejs/midi"></script>
    <script type="module" src="./midi-parser2.mjs"></script>
    
     <div id="partition" style="position: absolute;top: 0;  width: 27058px;background-color: aqua; height: 415px;" >
        <div id="D" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid red;display: flex;flex-direction: row;"></div>
        <div id="E" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid blue;display: flex;flex-direction: row;"></div>
        <div id="F" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid green;display: flex;flex-direction: row;"></div>
        <div id="G" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid black;display: flex;flex-direction: row;"></div>
        <div  id="A" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid red;display: flex;flex-direction: row;"></div>
        <div id="B" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid blue;display: flex;flex-direction: row;"></div>
        <div id="C" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid green;display: flex;flex-direction: row;"></div>
        <div id="F2" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid black;display: flex;flex-direction: row;"></div>      
        <div id="D2" style="width: 100%;background-color: rgba(0,0,0,0); height: 50px;border: 1px solid black;display: flex;flex-direction: row;"></div>      

    </div>
     <div #screen style="position: absolute;top: 0;left: 200px; width: 1200px;height: 415px; border: 1px solid black;background-color: rgba(0,0,0,0);"></div>
    <!-- GAME -->
    <!-- //pas besoin d'importer ça, on a déjà le JS en dur, ça créer des erreurs console pour double import -->
    <!-- <script src=»//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js »></script> -->
    <!-- <script type="text/javascript">
        var config = {
            type: Phaser.AUTO,
            width: 1280,
            height: 720,
            transparent: true,
            scene: {
                preload: preload,
                create: create,
                update: update
            },
            physics: {
                default: 'arcade',
                arcade: {
                    debug: true
                }
            }
        };

        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('sky', 'assets/sky.png');
            this.load.image('ground', 'assets/groundmvp.png');
            this.load.image('groundinvi', 'assets/groundinvi.png');
            this.load.image('obstacle1', 'assets/star.png');
            this.load.image('obstacle2', 'assets/star.png');


            this.load.spritesheet('perso', 'assets/perso-run.png', {
                frameWidth: 88,
                frameHeight: 94
            })

            this.load.spritesheet('perso-down', 'assets/perso-down.png', {
                //frameWidth: 118,
                //frameHeight: 94
                frameWidth: 88,
                frameHeight: 94
            })

            this.load.spritesheet('perso-up', 'assets/perso-jump.png', {
                frameWidth: 88,
                frameHeight: 94
            })
        }

        function create() {
            this.gameSpeed = 6;
            const { height, width } = this.game.config;
            this.add.image(640, 360, 'sky');

            this.ground = this.add.tileSprite(0, height, width, 170, 'ground').setOrigin(0, 1);

            //obstacle - notes
            this.obstacle1 = this.physics.add.sprite(680, 370, 'obstacle1');
            this.obstacle2 = this.physics.add.sprite(640, 580, 'obstacle2');


            // var platforms;
            platforms = this.physics.add.staticGroup();
            platforms.create(400, 680, 'groundinvi').setScale(2).refreshBody();
            platforms.create(400, 245, 'groundinvi').setScale(2).refreshBody();

            // let player
            player = this.physics.add.sprite(100, 400, 'perso');
            player.setCollideWorldBounds(true);
            player.setGravityY(5000);
            this.physics.add.collider(player, platforms);

            // console.log(this.physics.add.collider(player, platforms))
            
            
            this.anims.create({
                key: 'running',
                frames: this.anims.generateFrameNumbers('perso', { start: 0, end: 15 }),
                frameRate: 16,
                repeat: -1
            });

            this.anims.create({
                key: 'down',
                frames: this.anims.generateFrameNumbers('perso-down', { start: 0, end: 15 }),
                frameRate: 16,
                repeat: -1
            });

            this.anims.create({
                key: 'jump',
                frames: this.anims.generateFrameNumbers('perso-up', { start: 0, end: 8 }),
                frameRate: 16,
                repeat: -1
            });

            console.log(player.body.deltaAbsY());
            console.log(player.body.y);
            console.log(player);



            this.input.keyboard.on('keydown_SPACE', () => {
                player.body.height = 92;
                player.body.offset.y = 0;
                player.setVelocityY(-1600);
                player.anims.play('jump', true);

            })

            this.input.keyboard.on('keydown_DOWN', () => {

                player.body.height = 58;
                player.body.offset.y = 34;
            })

            if (this.physics.add.collider(player, platforms).active == true) {
                player.anims.play('running', true);
            }

            if (player.body.deltaAbsY() > 0) {
                player.anims.play('jump', true);
            } else {
                player.body.height <= 58 ?
                    player.anims.play('down', true) :
                    player.anims.play('running', true);
            }
        }

        function update() {
            this.ground.tilePositionX += this.gameSpeed;
            this.obstacle1.x -= this.gameSpeed;
            this.obstacle2.x -= this.gameSpeed;

            if (player.body.deltaAbsY() > 0) {
                player.anims.play('jump', true);
            } else {
                player.body.height <= 58 ?
                    player.anims.play('down', true) :
                    player.anims.play('running', true);
            }
        }
    </script> -->


</body>

</html>